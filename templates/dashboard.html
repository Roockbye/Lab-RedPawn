{% extends "base.html" %}
{% block title %}Dashboard â€” RedPawn SOC Lab{% endblock %}

{% block content %}
{% if all_complete %}
<!-- Badge de ComplÃ©tion -->
<div id="badge-overlay" class="badge-overlay">
    <div class="badge-content">
        <div class="badge-fireworks" id="badge-fireworks"></div>
        <div class="badge-medal">
            <div class="badge-glow"></div>
            <div class="badge-icon">ğŸ›¡ï¸</div>
        </div>
        <h1 class="badge-title">MISSION ACCOMPLIE</h1>
        <p class="badge-subtitle">Agent {{ session.username }}, vous avez terminÃ© toutes les missions de RedPawn SOC Lab.</p>
        <div class="badge-rank">ğŸ… RANG : EXPERT SOC â€” ELITE TIER ğŸ…</div>
        <div class="badge-score">Score final : {{ player.total_score }} / {{ total_possible }} points</div>
        <button class="badge-dismiss" onclick="dismissBadge()">Continuer â†’</button>
    </div>
</div>
{% endif %}

<div class="dashboard">
    <!-- Player Stats Bar -->
    <div class="stats-bar">
        <div class="stat-card">
            <div class="stat-icon">ğŸ†</div>
            <div class="stat-info">
                <span class="stat-value">{{ player.total_score }}</span>
                <span class="stat-label">Points</span>
            </div>
            <div class="stat-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {{ (player.total_score / total_possible * 100)|int if total_possible > 0 else 0 }}%"></div>
                </div>
                <span class="stat-detail">/ {{ total_possible }}</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">âœ…</div>
            <div class="stat-info">
                <span class="stat-value">{{ stats.correct_submissions }}</span>
                <span class="stat-label">Questions rÃ©solues</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ“</div>
            <div class="stat-info">
                <span class="stat-value">{{ stats.total_submissions }}</span>
                <span class="stat-label">Soumissions totales</span>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">ğŸ’¡</div>
            <div class="stat-info">
                <span class="stat-value">{{ stats.total_hints }}</span>
                <span class="stat-label">Indices utilisÃ©s</span>
            </div>
        </div>
    </div>

    <!-- Challenges by Level -->
    {% for level_num in [1, 2, 3, 4, 5] %}
    {% if level_num in challenges_by_level %}
    <div class="level-section">
        <div class="level-header" style="border-left-color: {{ levels[level_num].color }}">
            <h2>
                <span class="level-icon">{{ levels[level_num].icon }}</span>
                Niveau {{ level_num }} â€” {{ levels[level_num].name }}
            </h2>
            <span class="level-badge" style="background: {{ levels[level_num].color }}20; color: {{ levels[level_num].color }}">
                {{ challenges_by_level[level_num]|length }} challenges
            </span>
        </div>

        <div class="challenges-grid">
            {% for c in challenges_by_level[level_num] %}
            <a href="{{ url_for('challenge_view', challenge_id=c.id) }}" class="challenge-card {% if c.is_complete %}completed{% endif %}">
                <div class="card-header">
                    <span class="card-category">{{ categories[c.category].icon }} {{ categories[c.category].name }}</span>
                    {% if c.is_complete %}
                    <span class="card-status completed">âœ… TerminÃ©</span>
                    {% elif c.solved > 0 %}
                    <span class="card-status in-progress">ğŸ”„ En cours</span>
                    {% else %}
                    <span class="card-status new">ğŸ†• Nouveau</span>
                    {% endif %}
                </div>
                <h3 class="card-title">{{ c.title }}</h3>
                <div class="card-meta">
                    <span>â±ï¸ {{ c.estimated_time }}</span>
                    <span>ğŸ† {{ c.points_total }} pts</span>
                </div>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ c.progress_pct }}%; background: {{ levels[level_num].color }}"></div>
                    </div>
                    <span class="progress-text">{{ c.solved }}/{{ c.total }} questions</span>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% endblock %}
